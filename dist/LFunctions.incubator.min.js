this.L=this.L||{},this.L.application=this.L.application||{},this.L.application.Application=function(e){var t=this;this._siteUrl=e,this._requestDigest=null,this._nextRequestDigestTmestamp=(new Date).getTime()+6e4,this._startPromise=$.Deferred(),this.getRequestDigest=function(){return(new Date).getTime()>this._nextRequestDigestTmestamp&&(t.trace("Getting new Requestdigest"),jQuery.ajax({url:t._siteUrl+"/_api/contextinfo",type:"POST",success:function(e){t._requestDigest=e.d.GetContextWebInformation.FormDigestValue,t._nextRequestDigestTmestamp=(new Date).getTime()+6e4},error:function(e){t.error(e)},headers:{Accept:"application/json; odata=verbose","Content-Type":"application/json; odata=verbose"}})),this._requestDigest},jQuery.ajax({url:t._siteUrl+"/_api/contextinfo",type:"POST",success:function(e){t._requestDigest=e.d.GetContextWebInformation.FormDigestValue,t._startPromise.resolve(e)},error:function(e){t.error(e),t._startPromise.reject(e)},headers:{Accept:"application/json; odata=verbose","Content-Type":"application/json; odata=verbose"}}),this._started=!1,this._promise=this._startPromise,this._wirepromises=[],this.wire=function(e){var i=e(t);this._promise=this._promise.then(i),this._wirepromises.push(i)},this.ready=function(e){this._started||(t.log("starting App"),this._started=!0,this._startPromise.resolve()),$.when.apply($,this._wirepromises).then(function(){e(t)})},this.query=function(e){return new L.application.Query(this._siteUrl,e,this)},this.mixin={},this.mixin.newRepository=function(e,i){t.wire(function(t){return t[e]=new L.application.Repository(t._siteUrl,i,t),$.Deferred().resolve()})},this.mixin.newInMemoryRepository=function(e,i){t.wire(function(t){return t[e]=new L.application.InMemoryRepository(i),$.Deferred().resolve()})},this.mixin.dataFromQuery=function(e,i){t.wire(function(t){var n=i.execute(function(i){t[e]=i});return n})},this.trace=function(e){},this.log=function(e){},this.error=function(e){console.error(e)}},this.L.application.InMemoryQuery=function(e){var t=this;t._data=e,t.results=null,t._mapToSingle=!1,t._keyfield="",t._valuefield="",t.mapToSingleObject=function(e,i){return t._mapToSingle=!0,t._keyfield=e,t._valuefield=i,t},t.none=function(e){return null==t.results?t.execute(function(t){0==t.length&&e()}):0==t.results.length&&e(),t},t.each=function(e){return null==t.results?t.execute(function(t){$.each(t,function(t,i){e(t,i)})}):$.each(t.results,function(t,i){e(t,i)}),t},t.filter=function(e,i,n){var r=t._filterfunction;switch(i){case"eq":t._filterfunction=function(t,i){return t[e]==n&&r(t,i)};break;case"ne":t._filterfunction=function(t,i){return t[e]!=n&&r(t,i)}}return t},t._filterfunction=function(e,t){return!0},t.execute=function(e){var i=$.Deferred();if(t.results=jQuery.grep(t._data,t._filterfunction),t._mapToSingle){var n={};jQuery.each(t.results,function(e,i){n[i[t._keyfield]]=i[t._valuefield]}),t.results=n}return null!=e&&e(t.results),i.resolve(),i}},this.L.application.InMemoryRepository=function(e){var t=this;t._data=e,this.query=function(){return new L.application.InMemoryQuery(e)},this.insert=function(e){console.log("Not Implemented");var t=$.Deferred();return t.resolve(),t},this.remove=function(e){console.log("Not Implemented");var t=$.Deferred();return t.resolve(),t},this.startWorkflowOnItem=function(e,t){console.log("Not Implemented");var i=$.Deferred();return i.resolve(),i},this.update=function(e){console.log("Not Implemented");var t=$.Deferred();return t.resolve(),t}},this.L.application.Query=function(e,t,i){var n=this;this._application=i,this.getDigest=function(){return this._application&&this._application._requestDigest?this._application.getRequestDigest():$("#__REQUESTDIGEST").val()},n._filter="",n.endpoint=e+"/_api/web/lists/GetByTitle('"+t+"')/items",n.results=null,n.filter=function(e){return n._filter=e,n},n._mapToSingle=!1,n._keyfield="",n._valuefield="",n.mapToSingleObject=function(e,t){return n._mapToSingle=!0,n._keyfield=e,n._valuefield=t,n},n.none=function(e){return null==n.results?n.execute(function(t){0==t.length&&e()}):0==n.results.length&&e(),n},n.each=function(e){return null==n.results?n.execute(function(t){$.each(t,function(t,i){e(t,i)})}):$.each(n.results,function(t,i){e(t,i)}),n},n.execute=function(e){var t=this,i=this.endpoint+"?";""!=t._filter&&(i=i+"$filter="+t._filter+"&"),i+="$top=999999";var n=$.Deferred();return jQuery.ajax({url:i,method:"GET",success:function(i){if(t.results=i.d.results,t._mapToSingle){var r={};jQuery.each(t.results,function(e,i){r[i[t._keyfield]]=i[t._valuefield]}),t.results=r}null!=e&&e(t.results),n.resolve()},error:function(e){t._application.error(e),n.reject()},headers:{"X-RequestDigest":t.getDigest(),Accept:"application/json; odata=verbose","Content-Type":"application/json; odata=verbose"}}),n}},this.L.application.Repository=function(e,t,i){this._siteUrl=e,this._listname=t,this._application=i,this.getDigest=function(){return this._application&&this._application._requestDigest?this._application.getRequestDigest():$("#__REQUESTDIGEST").val()},this._endpoint=e+"/_api/web/lists/GetByTitle('"+t+"')/items",this.query=function(){return new L.application.Query(e,t,i)},this.insert=function(e){var t=this,i=$.extend({__metadata:{type:"SP.Data."+t._listname.charAt(0).toUpperCase()+t._listname.split(" ").join("").slice(1)+"ListItem"}},e),n=$.Deferred();return jQuery.ajax({url:this._endpoint,type:"POST",contentType:"application/json;odata=verbose",data:JSON.stringify(i),success:function(e){n.resolve(e)},error:function(e){t._application.error(e),n.reject(e)},headers:{"X-RequestDigest":""+t.getDigest(),Accept:"application/json; odata=verbose","Content-Type":"application/json; odata=verbose"}}),n},this.remove=function(e){var t=this,i=t.getDigest(),n=$.Deferred();return $.ajax({url:this._endpoint+"("+e+")",type:"POST",headers:{ACCEPT:"application/json;odata=verbose","content-type":"application/json;odata=verbose","X-RequestDigest":""+i,"IF-MATCH":"*","X-HTTP-Method":"DELETE"},success:function(e){n.resolve(e)},error:function(e){t._application.error(e),n.reject(e)}}),n},this.startWorkflowOnItem=function(e,t){return this._application.log("Starting Workflow "+t+" on item "+e),L.nintex.startWorkflowOnItem(this._siteUrl,this._listname,e,t)},this.update=function(e){var t=this,i=$.extend({__metadata:{type:"SP.Data."+t._listname.charAt(0).toUpperCase()+t._listname.split(" ").join("").slice(1)+"ListItem"}},e),n=$.Deferred();return jQuery.ajax({url:this._endpoint+"("+e.Id+")",type:"POST",contentType:"application/json;odata=verbose",data:JSON.stringify(i),success:function(e){n.resolve(e)},error:function(e){t._application.error(e),n.reject(e)},headers:{"X-RequestDigest":""+t.getDigest(),Accept:"application/json; odata=verbose","Content-Type":"application/json; odata=verbose","X-HTTP-Method":"MERGE","If-Match":e.__metadata.etag}}),n}},this.L.date=this.L.date||{},this.L.date.formatSPDate=function(e){var t=e.substring(11,13),i="AM";return t>12&&(t-=12,i="PM",t<10&&(t="0"+t)),e.substring(8,10)+"/"+e.substring(5,7)+"/"+e.substring(0,4)+" "+t+":"+e.substring(14,16)+" "+i},this.L.date.parseSPDate=function(e){var t=e.substring(e.indexOf(" ")+1,e.length),i=e.substring(0,e.indexOf(" ")),n=i.split("/"),r=t.split(":");return new Date(n[2],n[1]-1,n[0],r[0],r[1])},this.L.utils=this.L.utils||{},this.L.utils.getQueryParameter=function(e){var t=new RegExp("[\\?&]"+e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},this.L.utils.template=function(e,t){return e.replace(/\{\{(\w*)\}\}/g,function(e,i){return t[i]})},this.L.nintex=this.L.nintex||{},this.L.nintex.callNintexWorkFlowWS=function(e,t,i){var n=e+"/_vti_bin/NintexWorkflow/Workflow.asmx";return jQuery.ajax({type:"POST",cache:!1,async:!0,url:n,data:i,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://nintex.com/"+t)},contentType:"text/xml; charset=utf-8",dataType:"xml",error:function(e,t,i){console.error("Error calling Nintex Workflow Webservice")}})},this.L.nintex.startWorkflowOnItem=function(e,t,i,n){var r='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:m="http://nintex.com"><soap:Header></soap:Header><soap:Body><m:StartWorkflowOnListItem><m:itemId>{{itemID}}</m:itemId><m:listName>{{listname}}</m:listName><m:workflowName>{{wfname}}</m:workflowName><m:associationData></m:associationData></m:StartWorkflowOnListItem></soap:Body></soap:Envelope>';return r=L.utils.template(r,{listname:t,itemID:i,wfname:n}),L.nintex.callNintexWorkFlowWS(e,"StartWorkflowOnListItem",r)};